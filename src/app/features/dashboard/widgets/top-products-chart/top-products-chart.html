<div class="widget-header">
    <h3>{{ 'DASH.WIDGET.TOP_PRODUCTS.NAME' | translate }}</h3>

    <div class="header-actions" (mousedown)="$event.stopPropagation()">
        <!-- Botón de Exportación (como en InvoiceStatus) -->
        <div class="widget-edit-menu">
            <button class="icon-button" title="Exportar" (mousedown)="toggleExportMenu($event)">
                <lucide-icon [img]="MenuIcon" size="18"></lucide-icon>
            </button>
            @if (isExportMenuOpen()) {
            <div class="edit-dropdown export-dropdown" (mousedown)="$event.stopPropagation()">
                <button (mousedown)="viewFullscreen($event)">
                    <lucide-icon [img]="FullscreenIcon" size="14"></lucide-icon> Pantalla completa
                </button>
                <button (mousedown)="printChart($event)">
                    <lucide-icon [img]="PrintIcon" size="14"></lucide-icon> Imprimir gráfico
                </button>
                <hr />
                <span class="dropdown-title">Descargar</span>
                <button (mousedown)="downloadPNG($event)"><lucide-icon [img]="PngIcon" size="14"></lucide-icon> Imagen
                    PNG</button>
                <button (mousedown)="downloadJPEG($event)">Imagen JPEG</button>
                <button (mousedown)="downloadPDF($event)">Documento PDF</button>
                <button (mousedown)="downloadSVG($event)">Vector SVG</button>
                <hr />
                <button (mousedown)="downloadCSV($event)"><lucide-icon [img]="CsvIcon" size="14"></lucide-icon> Datos
                    CSV</button>
                <button (mousedown)="downloadXLS($event)">Hoja de cálculo XLS</button>
            </div>
            }
        </div>

        <!-- Botón de Configuración -->
        @if (isEditMode) {
        <div class="widget-edit-menu">
            <button class="icon-button" title="Configurar widget" (mousedown)="toggleSettings($event)">
                <lucide-icon [img]="SettingsIcon" size="18"></lucide-icon>
            </button>
            @if (isSettingsOpen()) {
            <div class="edit-dropdown" (mousedown)="$event.stopPropagation()">
                <div class="dropdown-section">
                    <span class="dropdown-title">{{ 'CHARTS.COMMON.CHART_TYPE' | translate }}</span>
                    <button (mousedown)="changeChartType('bar', $event)"
                        [class.active]="widget.chartType === 'bar' || !widget.chartType">
                        <lucide-icon [img]="BarIcon" size="14"></lucide-icon> {{ 'CHARTS.TYPE.BAR' | translate }}
                    </button>
                    <button (mousedown)="changeChartType('line', $event)" [class.active]="widget.chartType === 'line'">
                        <lucide-icon [img]="LineIcon" size="14"></lucide-icon> {{ 'CHARTS.TYPE.LINE' | translate }}
                    </button>
                </div>

                <div class="dropdown-section">
                    <span class="dropdown-title">Personalizar Colores</span>
                    @for (point of chartDataPoints(); track point.name) {
                    <div class="color-picker-item">
                        <label [for]="point.name">{{ point.name }}</label>
                        <input type="color" [id]="point.name" [value]="point.color"
                            (input)="updateSeriesColor($event, point.name!)">
                    </div>
                    }
                </div>
            </div>
            }
        </div>
        }
    </div>
</div>

<div class="widget-content">
    <highcharts-chart [options]="chartOptions()" (chartInstance)="onChartInstance($event)" class="chart-instance">
    </highcharts-chart>
</div>