<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema ERP - Plan de Cuentas Profesional</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --color-primary: #4f46e5;
            --color-primary-light: #e0e7ff;
            --color-primary-dark: #3730a3;
            --color-secondary: #1f2937;
            --color-background: #f9fafb;
            --color-surface: #ffffff;
            --color-text-primary: #111827;
            --color-text-secondary: #6b7280;
            --color-border: #e5e7eb;
            --color-success: #10b981;
            --color-danger: #ef4444;
            --color-warning: #f59e0b;
            --color-info: #3b82f6;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --border-radius: 0.5rem;
            --transition: all 0.3s ease;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--color-background);
            color: var(--color-text-primary);
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            line-height: 1.6;
        }

        /* --- Layout Principal --- */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* --- Sidebar --- */
        .sidebar {
            width: 260px;
            background: var(--color-secondary);
            color: white;
            padding: 1.5rem 0;
            transition: var(--transition);
            box-shadow: var(--shadow-md);
            z-index: 100;
        }

        .sidebar-header {
            padding: 0 1.5rem 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 1rem;
        }

        .sidebar-header h2 {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            margin: 0;
        }

        .nav-group {
            margin-bottom: 1.5rem;
        }

        .nav-group-title {
            text-transform: uppercase;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            padding: 0.5rem 1.5rem;
            color: #9ca3af;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            text-decoration: none;
            color: #d1d5db;
            gap: 0.75rem;
            transition: var(--transition);
            font-weight: 500;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .nav-item i {
            width: 24px;
            text-align: center;
        }

        /* --- Main Content --- */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* --- Topbar --- */
        .topbar {
            background: var(--color-surface);
            padding: 0.75rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--color-border);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 90;
        }

        .topbar-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--color-primary-light);
            color: var(--color-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        /* --- Page Container --- */
        .page-container {
            flex: 1;
            padding: 1.5rem;
            max-width: 1600px;
            margin: 0 auto;
            width: 100%;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .page-header h1 {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--color-secondary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin: 0;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            color: var(--color-text-secondary);
            font-size: 0.875rem;
            width: 100%;
            margin-top: 0.5rem;
        }

        .breadcrumb a {
            color: var(--color-text-secondary);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            color: var(--color-primary);
        }

        .breadcrumb .divider {
            margin: 0 0.5rem;
        }

        /* --- Cards --- */
        .card {
            background-color: var(--color-surface);
            border-radius: var(--border-radius);
            border: 1px solid var(--color-border);
            box-shadow: var(--shadow-md);
            margin-bottom: 1.5rem;
        }

        .card-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .card-body {
            padding: 1.5rem;
        }
        
        .card-body ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .card-body ul li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--color-border);
        }
        .card-body ul li:last-child {
            border-bottom: none;
        }

        .card-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--color-border);
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }

        /* --- Toolbar --- */
        .toolbar {
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex-wrap: wrap;
            background: #f8f9fa;
            border-bottom: 1px solid var(--color-border);
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-group label {
            font-weight: 500;
            color: var(--color-text-secondary);
            white-space: nowrap;
        }

        .search-bar {
            flex-grow: 1;
            position: relative;
            max-width: 400px;
        }

        .search-bar .fa-search {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-text-secondary);
        }

        .search-bar input {
            padding-left: 2.25rem;
        }

        .toolbar-actions {
            display: flex;
            gap: 0.5rem;
            margin-left: auto;
            flex-wrap: wrap;
        }

        /* --- Tablas y Árbol --- */
        .table-container {
            overflow-x: auto;
        }

        .account-tree {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }

        .tree-header, .tree-row {
            display: flex;
            align-items: center;
            padding: 0 1.5rem;
            border-bottom: 1px solid var(--color-border);
        }

        .tree-header {
            background-color: #f9fafb;
            font-weight: 600;
            color: var(--color-text-secondary);
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
            font-size: 0.75rem;
            text-transform: uppercase;
        }

        .tree-row {
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
            transition: background-color 0.2s ease;
        }

        .tree-row:hover {
            background-color: var(--color-primary-light);
        }

        .tree-row.inactive {
            color: var(--color-text-secondary);
            background-color: #f8f8f8;
            font-style: italic;
        }

        .tree-row.is-summary .account-name {
            font-weight: 600;
        }

        .tree-row.selected {
            background-color: #e0f2fe;
        }
        
        .tree-row .fa-exclamation-triangle {
            color: var(--color-warning);
            margin-left: 0.5rem;
            cursor: help;
        }

        /* --- Columnas del Árbol --- */
        .col-code { flex: 1; display: flex; align-items: center; gap: 0.5rem; }
        .col-name { flex: 3; display: flex; align-items: center; }
        .col-type { flex: 1.5; }
        .col-nature { flex: 1; }
        .col-postable { flex: 1; text-align: center; }
        .col-balance { flex: 1.5; text-align: right; font-family: monospace; }
        .col-status { flex: 1; }
        .col-actions { flex: 1.5; text-align: center; display: flex; gap: 0.5rem; justify-content: center; }

        /* --- Elementos UI --- */
        .account-code {
            background-color: var(--color-border);
            padding: 0.125rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
            font-weight: 500;
            font-family: monospace;
        }

        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            display: inline-block;
        }

        .type-asset { background-color: #d1fae5; color: #065f46; }
        .type-liability { background-color: #fee2e2; color: #991b1b; }
        .type-equity { background-color: #e0e7ff; color: #3730a3; }
        .type-revenue { background-color: #cffafe; color: #0e7490; }
        .type-expense { background-color: #ffedd5; color: #9a3412; }

        .status-active { background-color: #dcfce7; color: #166534; }
        .status-inactive { background-color: #fee2e2; color: #991b1b; }
        .status-pending { background-color: #fef3c7; color: #92400e; }
        .status-locked { background-color: #dbeafe; color: #1e40af; }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            border: 1px solid transparent;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.8125rem;
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--color-primary-dark);
        }

        .btn-secondary {
            background-color: var(--color-surface);
            color: var(--color-secondary);
            border-color: var(--color-border);
        }

        .btn-secondary:hover {
            background-color: var(--color-background);
        }

        .btn-success {
            background-color: var(--color-success);
            color: white;
        }

        .btn-danger {
            background-color: var(--color-danger);
            color: white;
        }

        .btn-warning {
            background-color: var(--color-warning);
            color: white;
        }

        .btn-icon {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--color-text-secondary);
            padding: 0.5rem;
            border-radius: 999px;
            width: 36px;
            height: 36px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-icon:hover {
            background-color: var(--color-primary-light);
            color: var(--color-primary);
        }

        .form-control {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            background-color: var(--color-surface);
            width: 100%;
            box-sizing: border-box;
            font-family: inherit;
            font-size: 0.875rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        .form-control.is-invalid {
            border-color: var(--color-danger);
        }
        .invalid-feedback {
            color: var(--color-danger);
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }

        select.form-control {
            min-width: 200px;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--color-text-primary);
        }

        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-col {
            flex: 1;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .alert {
            padding: 1rem;
            border-radius: var(--border-radius);
            margin: 1rem 0;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .alert i {
            font-size: 1.25rem;
            margin-top: 2px;
        }

        .alert-warning {
            background-color: #fffbeb;
            color: #b45309;
            border: 1px solid #fcd34d;
        }

        .alert-danger {
            background-color: #fef2f2;
            color: #b91c1c;
            border: 1px solid #fecaca;
        }

        .alert-info {
            background-color: #eff6ff;
            color: #1d4ed8;
            border: 1px solid #bfdbfe;
        }

        .alert-success {
            background-color: #ecfdf5;
            color: #047857;
            border: 1px solid #a7f3d0;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid var(--color-border);
            margin-bottom: 1.5rem;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            font-weight: 500;
            color: var(--color-text-secondary);
            border-bottom: 3px solid transparent;
            transition: var(--transition);
        }

        .tab.active {
            color: var(--color-primary);
            border-bottom: 3px solid var(--color-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .audit-log {
            max-height: 300px;
            overflow-y: auto;
        }

        .audit-item {
            padding: 0.75rem;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            gap: 1rem;
        }

        .audit-item:last-child {
            border-bottom: none;
        }

        .audit-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--color-primary-light);
            color: var(--color-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .audit-details {
            flex: 1;
        }

        .audit-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.25rem;
        }

        .audit-title {
            font-weight: 600;
            color: var(--color-text-primary);
        }

        .audit-time {
            color: var(--color-text-secondary);
            font-size: 0.875rem;
        }

        .audit-description {
            color: var(--color-text-secondary);
            font-size: 0.875rem;
        }

        .audit-changes {
            margin-top: 0.5rem;
            padding: 0.5rem;
            background: #f9fafb;
            border-radius: var(--border-radius);
            font-size: 0.8125rem;
        }

        .change-item {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.25rem;
        }

        .change-field {
            font-weight: 500;
            min-width: 120px;
        }

        /* --- Modal --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }

        .modal-overlay.visible .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--color-border);
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--color-border);
            margin-top: 1.5rem;
        }

        /* --- Responsividad --- */
        @media (max-width: 1200px) {
            .sidebar {
                width: 80px;
            }
            
            .sidebar .nav-text {
                display: none;
            }
            
            .sidebar-header h2 span {
                display: none;
            }
            
            .sidebar-header {
                padding: 1rem;
                text-align: center;
            }
        }

        @media (max-width: 992px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
        }

        @media (max-width: 768px) {
            .toolbar {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }
            
            .toolbar-actions {
                margin-left: 0;
                justify-content: center;
            }
            
            .search-bar {
                max-width: 100%;
            }
            
            .modal-content {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-cubes"></i> <span>ERP Contable</span></h2>
            </div>
            
            <div class="nav-group">
                <div class="nav-group-title">Contabilidad</div>
                <a href="#" class="nav-item active">
                    <i class="fas fa-sitemap"></i>
                    <span class="nav-text">Plan de Cuentas</span>
                </a>
                 <a href="#" class="nav-item">
                    <i class="fas fa-book"></i>
                    <span class="nav-text">Asientos Contables</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-balance-scale"></i>
                    <span class="nav-text">Balance General</span>
                </a>
            </div>
            <div class="nav-group">
                <div class="nav-group-title">Administración</div>
                <a href="#" class="nav-item">
                    <i class="fas fa-users-cog"></i>
                    <span class="nav-text">Usuarios</span>
                </a>
                 <a href="#" class="nav-item">
                    <i class="fas fa-shield-alt"></i>
                    <span class="nav-text">Seguridad</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-history"></i>
                    <span class="nav-text">Auditoría</span>
                </a>
            </div>
        </div>

        <div class="main-content">
            <div class="topbar">
                 <div class="topbar-actions">
                    <button class="btn btn-icon" id="sidebar-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Buscar en el sistema..." class="form-control">
                    </div>
                </div>
                
                <div class="topbar-actions">
                    <button class="btn btn-icon" title="Notificaciones">
                        <i class="fas fa-bell"></i>
                    </button>
                    <div class="user-profile">
                        <div class="user-avatar">AM</div>
                        <div>
                            <div class="user-name">Ana Martínez</div>
                            <div class="user-role">Contador Senior</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="page-container">
                <div class="page-header">
                    <h1><i class="fas fa-sitemap" style="color: var(--color-primary);"></i> Plan de Cuentas</h1>
                    <div>
                        <button class="btn btn-primary" id="btn-new-account">
                            <i class="fas fa-plus"></i> Nueva Cuenta
                        </button>
                         <button class="btn btn-secondary" id="btn-import">
                            <i class="fas fa-file-import"></i> Importar
                        </button>
                    </div>
                    <div class="breadcrumb">
                        <a href="#">Inicio</a>
                        <span class="divider">/</span>
                        <span>Plan de Cuentas</span>
                    </div>
                </div>
                
                <div class="card">
                    <div class="toolbar">
                        <div class="filter-group">
                            <label for="version-selector"><i class="fas fa-code-branch"></i> Versión:</label>
                            <select id="version-selector" class="form-control">
                                <option value="v2">v2 - Plan 2025 (Vigente: 01/01/2025 - 31/12/2025)</option>
                                <option value="v1">v1 - Plan 2024 (Histórico: 01/01/2024 - 31/12/2024)</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="hierarchy-selector"><i class="fas fa-layer-group"></i> Jerarquía:</label>
                            <select id="hierarchy-selector" class="form-control">
                                <option value="legal">Legal</option>
                                <option value="management">Gestión</option>
                                <option value="fiscal">Fiscal</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="entity-selector"><i class="fas fa-building"></i> Entidad:</label>
                            <select id="entity-selector" class="form-control">
                                <option value="main">Matriz Principal (DOM)</option>
                                <option value="sub1">Subsidiaria Norte (USA)</option>
                                <option value="sub2">Subsidiaria Sur (COL)</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="book-selector"><i class="fas fa-book"></i> Libro:</label>
                            <select id="book-selector" class="form-control">
                                <option value="gaap">NIIF</option>
                                <option value="local">Local GAAP</option>
                                <option value="tax">Fiscal</option>
                            </select>
                        </div>
                        <div class="search-bar">
                            <i class="fas fa-search"></i>
                            <input type="text" id="search-input" placeholder="Buscar por código o nombre..." class="form-control">
                        </div>
                        <div class="toolbar-actions">
                            <button class="btn btn-secondary" title="Clonar Plan de Cuentas" id="btn-clone-plan">
                               <i class="fas fa-clone"></i> Clonar Plan
                            </button>
                             <button class="btn btn-secondary" id="btn-create-version" title="Crear Nueva Versión">
                                <i class="fas fa-plus-circle"></i> Nueva Versión
                            </button>
                            <button class="btn btn-success" id="btn-export">
                                <i class="fas fa-file-export"></i> Exportar
                            </button>
                        </div>
                    </div>
                </div>

                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <strong>Período de cierre activo (01/08/2025 - 15/08/2025).</strong> 
                        Los cambios estructurales al plan de cuentas están bloqueados. Las nuevas cuentas o ediciones críticas requieren aprobación por un usuario con rol de 'Supervisor Contable'. Usted (Ana Martínez, Contador Senior) puede solicitar los cambios.
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col" style="flex: 3;">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title"><i class="fas fa-list"></i> Cuentas Contables</h3>
                            </div>
                            <div class="table-container">
                                <div class="account-tree">
                                    <div class="tree-header">
                                        <div class="col-code">Código</div>
                                        <div class="col-name">Nombre</div>
                                        <div class="col-type">Tipo</div>
                                        <div class="col-nature">Naturaleza</div>
                                        <div class="col-postable">Imputable</div>
                                        <div class="col-balance">Balance</div>
                                        <div class="col-status">Estado</div>
                                        <div class="col-actions">Acciones</div>
                                    </div>
                                    <div class="tree-body" id="tree-body">
                                        </div>
                                </div>
                            </div>
                             <div class="card-footer">
                                <div style="color: var(--color-text-secondary); font-size: 0.875rem;">
                                    Mostrando <strong>13</strong> de <strong>13</strong> cuentas
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-col" style="flex: 1;">
                        <div class="card" id="data-quality-panel">
                            <div class="card-header">
                                <h3 class="card-title"><i class="fas fa-shield-alt"></i> Salud del Plan de Cuentas</h3>
                            </div>
                            <div class="card-body">
                                <ul>
                                    <li>
                                        <span><i class="fas fa-copy" style="color:var(--color-warning); margin-right: 8px;"></i> Cuentas con nombre similar</span>
                                        <strong class="badge" style="background-color: var(--color-warning); color: white;">1</strong>
                                    </li>
                                    <li>
                                        <span><i class="fas fa-dollar-sign" style="color:var(--color-danger); margin-right: 8px;"></i> Sumarias con saldo</span>
                                        <strong class="badge" style="background-color: var(--color-danger); color: white;">1</strong>
                                    </li>
                                    <li>
                                        <span><i class="fas fa-unlink" style="color:var(--color-info); margin-right: 8px;"></i> Cuentas huérfanas</span>
                                        <strong class="badge" style="background-color: var(--color-info); color: white;">0</strong>
                                    </li>
                                     <li>
                                        <span><i class="fas fa-question-circle" style="color:var(--color-text-secondary); margin-right: 8px;"></i> Imputables sin movimientos</span>
                                        <strong class="badge" style="background-color: var(--color-text-secondary); color: white;">2</strong>
                                    </li>
                                </ul>
                            </div>
                            <div class="card-footer" style="justify-content: center;">
                                <button class="btn btn-secondary btn-sm">
                                    <i class="fas fa-chart-line"></i> Ver Reporte de Calidad
                                </button>
                            </div>
                        </div>
                    </div>
                 </div>

                <div class="form-row">
                    <div class="form-col">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title"><i class="fas fa-info-circle"></i> Detalles de la Cuenta</h3>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info" id="no-selection-alert">
                                    <i class="fas fa-mouse-pointer"></i>
                                    <div>Seleccione una cuenta para ver sus detalles</div>
                                </div>
                                <div id="account-details" style="display: none;">
                                    </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title"><i class="fas fa-history"></i> Historial de Cambios (Auditoría)</h3>
                            </div>
                            <div class="card-body">
                                <div class="audit-log" id="audit-log">
                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="account-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title"><i class="fas fa-plus-circle"></i> Nueva Cuenta Contable</h2>
                <button class="btn-icon modal-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tabs">
                    <div class="tab active" data-tab="general">General</div>
                    <div class="tab" data-tab="advanced">Avanzado y Control</div>
                    <div class="tab" data-tab="mapping">Mapeos (GAAP/Fiscal)</div>
                    <div class="tab" data-tab="dimensions">Dimensiones</div>
                </div>
                
                <div class="tab-content active" id="general-tab">
                    <div class="form-group">
                        <label class="form-label">Usar Plantilla (Opcional)</label>
                        <select class="form-control" id="account-template-select">
                            <option value="">Ninguna</option>
                            <option value="banco">Plantilla para Cuenta Bancaria</option>
                            <option value="gasto">Plantilla para Gasto Operativo</option>
                            <option value="ingreso">Plantilla para Ingreso por Ventas</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label">Código de Cuenta *</label>
                                <input type="text" class="form-control" placeholder="Ej: 110101" id="account-code-input">
                                <small class="form-text text-muted">Máscara de formato sugerida: X-XX-XX-XX</small>
                                <div class="invalid-feedback" id="code-feedback" style="display: none;">El código no cumple con la máscara.</div>
                            </div>
                        </div>
                        <div class="form-col">
                             <div class="form-group">
                                <label class="form-label">Nombre de Cuenta *</label>
                                <input type="text" class="form-control" placeholder="Ej: Caja General" id="account-name-input">
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label">Tipo de Cuenta *</label>
                                <select class="form-control" id="account-type-select">
                                    <option value="">Seleccionar tipo</option>
                                    <option value="ASSET">Activo</option>
                                    <option value="LIABILITY">Pasivo</option>
                                    <option value="EQUITY">Patrimonio</option>
                                    <option value="REVENUE">Ingreso</option>
                                    <option value="EXPENSE">Gasto</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label">Naturaleza *</label>
                                <select class="form-control" id="account-nature-select">
                                    <option value="">Seleccionar naturaleza</option>
                                    <option value="DEBIT">Deudora</option>
                                    <option value="CREDIT">Acreedora</option>
                                </select>
                            </div>
                        </div>
                    </div>
                     <div class="form-group">
                        <label class="form-label">Cuenta Padre</label>
                        <select class="form-control" id="account-parent-select">
                            </select>
                    </div>
                     <div class="form-group">
                        <label class="form-label">Descripción</label>
                        <textarea class="form-control" rows="2" placeholder="Descripción detallada de la cuenta..." id="account-description"></textarea>
                    </div>
                </div>
                
                <div class="tab-content" id="advanced-tab">
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label">Estado *</label>
                                <select class="form-control" id="account-status-select">
                                    <option value="ACTIVE">Activa</option>
                                    <option value="INACTIVE">Inactiva</option>
                                    <option value="PENDING">Pendiente de Aprobación</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label">Fecha de Efectividad *</label>
                                <input type="date" class="form-control" value="2025-08-04" id="account-date-input">
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                             <div class="form-group">
                                <label class="form-label">Moneda de la Cuenta *</label>
                                <select class="form-control" id="account-currency-select">
                                    <option value="DOP">DOP - Peso Dominicano</option>
                                    <option value="USD">USD - Dólar Estadounidense</option>
                                    <option value="EUR">EUR - Euro</option>
                                </select>
                            </div>
                        </div>
                         <div class="form-col">
                            <div class="form-group">
                                <label class="form-label">Cuenta de Diferencia Cambiaria (CTA)</label>
                                <select class="form-control" id="account-cta-select" disabled>
                                    </select>
                            </div>
                        </div>
                    </div>
                     <div class="form-group">
                        <label class="form-label">Propiedades y Controles</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item"><input type="checkbox" id="postable"><label for="postable">Imputable</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="reconciliation"><label for="reconciliation">Requiere Conciliación</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="bank-account"><label for="bank-account">Es Caja/Banco</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="intercompany"><label for="intercompany">Permite Intercompañía</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="multicurrency"><label for="multicurrency">Permite Multi-Moneda</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="manual-lock"><label for="manual-lock">Bloquear Asientos Manuales</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="subledger-lock"><label for="subledger-lock">Bloquear desde Subledgers</label></div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="mapping-tab">
                    <div class="alert alert-info"><i class="fas fa-info-circle"></i> Defina los códigos equivalentes para reportes fiscales y otros libros contables.</div>
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label">Código Fiscal (Ej: IT-1, 606)</label>
                                <input type="text" class="form-control" placeholder="Ej: A01.1" id="fiscal-code">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label">Código XBRL</label>
                                <input type="text" class="form-control" placeholder="Ej: ifrs-full_Cash" id="xbrl-code">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Mapeo a Libros Contables Alternativos</label>
                         <table class="table-container" style="width: 100%; font-size: 0.875rem;">
                            <thead>
                                <tr class="tree-header">
                                    <th style="flex:1">Libro Contable</th>
                                    <th style="flex:2">Cuenta Equivalente</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="tree-row">
                                    <td style="flex:1">Local GAAP</td>
                                    <td style="flex:2"><input type="text" class="form-control form-control-sm" placeholder="Opcional, si es diferente"></td>
                                </tr>
                                <tr class="tree-row">
                                    <td style="flex:1">Fiscal</td>
                                    <td style="flex:2"><input type="text" class="form-control form-control-sm" placeholder="Opcional, si es diferente"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="dimensions-tab">
                    <div class="alert alert-info"><i class="fas fa-info-circle"></i> Especifique qué dimensiones son obligatorias al usar esta cuenta.</div>
                     <div class="form-group">
                        <label class="form-label">Dimensiones Requeridas</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item"><input type="checkbox" id="dim-cc"><label for="dim-cc">Centro de Costo</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="dim-project"><label for="dim-project">Proyecto</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="dim-department"><label for="dim-department">Departamento</label></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Reglas de Validación Cruzada (Cross-Validation Rules)</label>
                        <select class="form-control" id="validation-rules">
                            <option value="">Ninguna</option>
                            <option value="rule1">Regla 001: Gastos de Depto. Ventas solo con CC de Ventas</option>
                            <option value="rule2">Regla 002: Proyectos de I+D solo con cuentas de Activos Intangibles</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 1.5rem;">
                    <label class="form-label">Motivo del Cambio/Creación *</label>
                    <textarea class="form-control" rows="2" placeholder="Especifique la razón de este cambio para fines de auditoría..." id="change-reason"></textarea>
                </div>
                <div class="alert alert-warning" id="modal-approval-alert">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div><strong>Período de cierre activo</strong> - Este cambio requerirá aprobación de un supervisor antes de ser efectivo.</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close-btn">Cancelar</button>
                <button class="btn btn-primary" id="modal-save-btn">Guardar y Solicitar Aprobación</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="clone-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-clone"></i> Clonar Plan de Cuentas</h2>
                <button class="btn-icon modal-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Plan de Origen *</label>
                    <select class="form-control">
                        <option>v2 - Plan 2025 (Matriz Principal)</option>
                    </select>
                </div>
                 <div class="form-group">
                    <label class="form-label">Entidad de Destino *</label>
                    <select class="form-control">
                        <option>Subsidiaria Norte (USA)</option>
                        <option>Subsidiaria Sur (COL)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Prefijo para Nuevos Códigos (si hay conflicto)</label>
                    <input type="text" class="form-control" placeholder="Ej: US-">
                </div>
                 <div class="form-group">
                    <label class="form-label">Opciones de Clonación</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item"><input type="checkbox" checked><label>Clonar estructura y atributos</label></div>
                        <div class="checkbox-item"><input type="checkbox" checked><label>Clonar mapeos fiscales</label></div>
                        <div class="checkbox-item"><input type="checkbox"><label>Clonar reglas de dimensión</label></div>
                    </div>
                </div>
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <div>El proceso de clonación creará una nueva versión del plan de cuentas en estado 'Borrador' para la entidad de destino, pendiente de revisión y activación.</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close-btn">Cancelar</button>
                <button class="btn btn-primary">Iniciar Clonación</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="version-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-code-branch"></i> Crear Nueva Versión del Plan</h2>
                <button class="btn-icon modal-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Basado en la Versión</label>
                    <select class="form-control">
                         <option value="v2">v2 - Plan 2025</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Código de la Nueva Versión *</label>
                    <input type="text" class="form-control" value="v3">
                </div>
                 <div class="form-group">
                    <label class="form-label">Nombre de la Nueva Versión *</label>
                    <input type="text" class="form-control" placeholder="Ej: Plan 2026">
                </div>
                 <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Vigencia Desde *</label>
                            <input type="date" class="form-control" value="2026-01-01">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Vigencia Hasta *</label>
                            <input type="date" class="form-control" value="2026-12-31">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close-btn">Cancelar</button>
                <button class="btn btn-primary">Crear Versión</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATOS SIMULADOS MEJORADOS ---
            const accountsData = [
                { id: '1', parentId: null, code: '1', name: 'Activos', isPostable: false, type: 'ASSET', nature: 'DEBIT', balance: 1850000, status: 'ACTIVE', hasWarning: false },
                { id: '11', parentId: '1', code: '1-10', name: 'Activos Corrientes', isPostable: false, type: 'ASSET', nature: 'DEBIT', balance: 950000, status: 'ACTIVE', hasWarning: true, warningMsg: 'Esta cuenta sumaria tiene saldo. Debería ser 0.' },
                { id: '1101', parentId: '11', code: '1-10-01', name: 'Efectivo y Equivalentes', isPostable: false, type: 'ASSET', nature: 'DEBIT', balance: 350000, status: 'ACTIVE', hasWarning: false },
                { id: '110101', parentId: '1101', code: '1-10-01-01', name: 'Caja General', isPostable: true, type: 'ASSET', nature: 'DEBIT', balance: 75000, status: 'ACTIVE', hasWarning: false },
                { id: '110102', parentId: '1101', code: '1-10-01-02', name: 'Banco de Reservas', isPostable: true, type: 'ASSET', nature: 'DEBIT', balance: 275000, status: 'ACTIVE', hasWarning: false },
                { id: '12', parentId: '1', code: '1-20', name: 'Activos No Corrientes', isPostable: false, type: 'ASSET', nature: 'DEBIT', balance: 900000, status: 'ACTIVE', hasWarning: false },
                { id: '1201', parentId: '12', code: '1-20-01', name: 'Propiedad, Planta y Equipo', isPostable: true, type: 'ASSET', nature: 'DEBIT', balance: 900000, status: 'ACTIVE', hasWarning: false },
                { id: '2', parentId: null, code: '2', name: 'Pasivos', isPostable: false, type: 'LIABILITY', nature: 'CREDIT', balance: 400000, status: 'ACTIVE', hasWarning: false },
                { id: '4', parentId: null, code: '4', name: 'Ingresos', isPostable: false, type: 'REVENUE', nature: 'CREDIT', balance: 1200000, status: 'ACTIVE', hasWarning: false },
                { id: '6', parentId: null, code: '6', name: 'Gastos', isPostable: false, type: 'EXPENSE', nature: 'DEBIT', balance: 500000, status: 'ACTIVE', hasWarning: false },
                { id: '61', parentId: '6', code: '6-10', name: 'Gastos Operativos', isPostable: false, type: 'EXPENSE', nature: 'DEBIT', balance: 500000, status: 'ACTIVE', hasWarning: false },
                { id: '6101', parentId: '61', code: '6-10-01', name: 'Sueldos y Salarios', isPostable: true, type: 'EXPENSE', nature: 'DEBIT', balance: 350000, status: 'ACTIVE', hasWarning: false },
                { id: '6102', parentId: '61', code: '6-10-02', name: 'Gastos de Alquiler', isPostable: true, type: 'EXPENSE', nature: 'DEBIT', balance: 150000, status: 'ACTIVE', hasWarning: true, warningMsg: 'Nombre similar a la cuenta 6-10-03 (Alquileres). Considere fusionar.' },
            ];

            // --- ESTADO Y ELEMENTOS DEL DOM ---
            const state = { selectedAccount: null };
            const treeBody = document.getElementById('tree-body');
            const accountModal = document.getElementById('account-modal');
            const cloneModal = document.getElementById('clone-modal');
            const versionModal = document.getElementById('version-modal');
            const accountDetails = document.getElementById('account-details');
            const noSelectionAlert = document.getElementById('no-selection-alert');
            const auditLog = document.getElementById('audit-log');

            // --- FUNCIONES UTILITARIAS ---
            const formatCurrency = (amount) => new Intl.NumberFormat('es-DO', { style: 'currency', currency: 'DOP' }).format(amount);
            const showModal = (modal) => modal.classList.add('visible');
            const closeModal = (modal) => modal.classList.remove('visible');
            
            // --- LÓGICA DEL ÁRBOL ---
            const buildTree = (accounts, parentId = null) => {
                return accounts
                    .filter(acc => acc.parentId === parentId)
                    .map(acc => ({ ...acc, children: buildTree(accounts, acc.id) }));
            };

            const renderTree = (accounts, level = 0) => {
                let html = '';
                for (const account of accounts) {
                    const hasChildren = account.children && account.children.length > 0;
                    html += `
                        <div class="tree-row" data-id="${account.id}" style="padding-left: ${level * 25}px;">
                            <div class="col-code"><span class="account-code">${account.code}</span></div>
                            <div class="col-name">
                                ${account.name}
                                ${account.hasWarning ? `<i class="fas fa-exclamation-triangle" title="${account.warningMsg}"></i>` : ''}
                            </div>
                            <div class="col-type"><span class="badge type-${account.type.toLowerCase()}">${account.type}</span></div>
                            <div class="col-nature">${account.nature}</div>
                            <div class="col-postable">
                                <i class="${account.isPostable ? 'fas fa-check-circle' : 'fas fa-minus-circle'}" style="color: ${account.isPostable ? 'var(--color-success)' : 'var(--color-text-secondary)'};"></i>
                            </div>
                            <div class="col-balance">${formatCurrency(account.balance)}</div>
                            <div class="col-status"><span class="badge status-${account.status.toLowerCase()}">${account.status}</span></div>
                            <div class="col-actions">
                                <button class="btn-icon btn-edit" title="Editar" data-id="${account.id}"><i class="fas fa-pencil-alt"></i></button>
                                <button class="btn-icon btn-more" title="Más acciones" data-id="${account.id}"><i class="fas fa-ellipsis-v"></i></button>
                            </div>
                        </div>
                    `;
                    if (hasChildren) {
                        html += renderTree(account.children, level + 1);
                    }
                }
                return html;
            };

            // --- LÓGICA DE DETALLES Y AUDITORÍA ---
            const showAccountDetailsContent = (accountId) => {
                // Simulación, en un sistema real esto vendría de una API
                const html = `
                    <div class="form-group"><label>Código:</label><div class="account-code">1-10-01-01</div></div>
                    <div class="form-group"><label>Nombre:</label><div><strong>Caja General</strong></div></div>
                    <div class="form-row">
                        <div class="form-col"><div class="form-group"><label>Tipo:</label><div><span class="badge type-asset">ASSET</span></div></div></div>
                        <div class="form-col"><div class="form-group"><label>Naturaleza:</label><div>DEBIT</div></div></div>
                    </div>
                    <div class="form-group"><label>Dimensiones Requeridas:</label><div>Centro de Costo</div></div>
                    <div class="form-group"><label>Mapeo Fiscal:</label><div>A01.1.1.1</div></div>
                `;
                accountDetails.innerHTML = html;
                accountDetails.style.display = 'block';
                noSelectionAlert.style.display = 'none';
            };

            const renderAuditLogContent = () => {
                auditLog.innerHTML = `
                     <div class="audit-item">
                        <div class="audit-icon"><i class="fas fa-check-double"></i></div>
                        <div class="audit-details">
                            <div class="audit-header"><div class="audit-title">Aprobación de Cambio</div><div class="audit-time">Hace 1 día</div></div>
                            <div class="audit-description">Aprobado por <strong>Maria Rodriguez (Supervisor)</strong></div>
                            <div class="audit-changes"><div class="change-item"><span class="change-field">Motivo:</span><span>Ajuste de fin de mes.</span></div></div>
                        </div>
                    </div>
                    <div class="audit-item">
                        <div class="audit-icon"><i class="fas fa-pencil-alt"></i></div>
                        <div class="audit-details">
                            <div class="audit-header"><div class="audit-title">Actualización de cuenta</div><div class="audit-time">Hace 2 días</div></div>
                            <div class="audit-description">Solicitado por <strong>Ana Martínez</strong></div>
                            <div class="audit-changes"><div class="change-item"><span class="change-field">Campo:</span><span>Nombre</span></div></div>
                        </div>
                    </div>
                `;
            };

            // --- LÓGICA DE MODALES ---
            const openAccountModal = (isEdit = false, accountData = null) => {
                document.getElementById('modal-title').innerHTML = isEdit ? '<i class="fas fa-pencil-alt"></i> Editar Cuenta Contable' : '<i class="fas fa-plus-circle"></i> Nueva Cuenta Contable';
                // Llenar selects de padres y CTA
                const parentSelect = document.getElementById('account-parent-select');
                const ctaSelect = document.getElementById('account-cta-select');
                parentSelect.innerHTML = '<option value="">Ninguna (Cuenta raíz)</option>';
                ctaSelect.innerHTML = '<option value="">Seleccionar cuenta...</option>';
                accountsData.forEach(acc => {
                    if (!acc.isPostable) parentSelect.innerHTML += `<option value="${acc.id}">${acc.code} - ${acc.name}</option>`;
                    if (acc.isPostable) ctaSelect.innerHTML += `<option value="${acc.id}">${acc.code} - ${acc.name}</option>`;
                });
                
                // Si es edición, poblar campos
                if(isEdit && accountData) {
                    // Lógica para poblar el modal con datos de `accountData`
                }
                
                showModal(accountModal);
            };
            
            document.getElementById('account-template-select').addEventListener('change', (e) => {
                const template = e.target.value;
                if(template === 'banco') {
                    document.getElementById('account-type-select').value = 'ASSET';
                    document.getElementById('account-nature-select').value = 'DEBIT';
                    document.getElementById('reconciliation').checked = true;
                    document.getElementById('bank-account').checked = true;
                } else if (template === 'gasto') {
                    document.getElementById('account-type-select').value = 'EXPENSE';
                    document.getElementById('account-nature-select').value = 'DEBIT';
                    document.getElementById('dim-cc').checked = true;
                }
            });

            document.getElementById('multicurrency').addEventListener('change', (e) => {
                 document.getElementById('account-cta-select').disabled = !e.target.checked;
            });

            // --- MANEJO DE EVENTOS ---
            document.getElementById('btn-new-account').addEventListener('click', () => openAccountModal(false));
            document.getElementById('btn-clone-plan').addEventListener('click', () => showModal(cloneModal));
            document.getElementById('btn-create-version').addEventListener('click', () => showModal(versionModal));

            document.querySelectorAll('.modal-close-btn').forEach(btn => {
                btn.addEventListener('click', () => closeModal(btn.closest('.modal-overlay')));
            });

            treeBody.addEventListener('click', (e) => {
                const row = e.target.closest('.tree-row');
                if (row) {
                    document.querySelectorAll('.tree-row').forEach(r => r.classList.remove('selected'));
                    row.classList.add('selected');
                    state.selectedAccount = row.dataset.id;
                    showAccountDetailsContent(state.selectedAccount);
                }
                
                const editButton = e.target.closest('.btn-edit');
                if(editButton) {
                    const accountId = editButton.dataset.id;
                    const account = accountsData.find(acc => acc.id === accountId);
                    openAccountModal(true, account);
                }
            });
            
             // Manejo de tabs en modal
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const modalBody = tab.closest('.modal-body');
                    modalBody.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    modalBody.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
                });
            });

            // --- RENDERIZADO INICIAL ---
            const initialTree = buildTree(accountsData);
            treeBody.innerHTML = renderTree(initialTree);
            renderAuditLogContent();
        });
    </script>
</body>
</html>